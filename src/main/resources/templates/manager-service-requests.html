<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
    <head th:replace="~{fragments/head :: head}"></head>
    <body>
        <div th:replace="~{fragments/navbar :: navbar}"></div>
        <div th:replace="~{fragments/sidebar :: sidebar}"></div>

        <div class="main-content">
            <h2 class="mb-4 text-primary">Service Request Fulfillment</h2>

            <div
                th:if="${success}"
                class="alert alert-success alert-dismissible fade show"
            >
                <i class="bi bi-check-circle-fill me-2"></i>
                <span th:text="${success}"></span>
                <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="alert"
                ></button>
            </div>
            <div
                th:if="${error}"
                class="alert alert-danger alert-dismissible fade show"
            >
                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                <span th:text="${error}"></span>
                <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="alert"
                ></button>
            </div>

            <div class="card shadow-sm">
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Req ID</th>
                                    <th>Customer</th>
                                    <th>Request Type</th>
                                    <th>Date Requested</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="req : ${requests}">
                                    <td
                                        class="text-muted"
                                        th:text="'#SR-' + ${req.id}"
                                    >
                                        #SR-101
                                    </td>

                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div
                                                class="avatar-circle bg-light text-primary me-2"
                                            >
                                                <i class="bi bi-person"></i>
                                            </div>
                                            <div>
                                                <span
                                                    class="d-block fw-bold"
                                                    th:text="${req.account.user.username}"
                                                    >User</span
                                                >
                                                <small
                                                    class="text-muted"
                                                    th:text="${req.account.user.email}"
                                                    >user@bank.com</small
                                                >
                                            </div>
                                        </div>
                                    </td>

                                    <td>
                                        <span
                                            class="badge"
                                            th:classappend="${req.requestType == 'CHEQUE_BOOK'} ? 'bg-info text-dark' : 'bg-warning text-dark'"
                                            th:text="${req.requestType}"
                                            >CHEQUE_BOOK</span
                                        >
                                    </td>

                                    <td
                                        th:text="${#temporals.format(req.requestDate, 'dd-MMM-yyyy HH:mm')}"
                                    >
                                        Date
                                    </td>

                                    <td>
                                        <div class="d-flex gap-2">
                                            <form
                                                th:action="@{/manager/services/approve}"
                                                method="post"
                                            >
                                                <input
                                                    type="hidden"
                                                    name="id"
                                                    th:value="${req.id}"
                                                />
                                                <button
                                                    type="submit"
                                                    class="btn btn-sm btn-success"
                                                    onclick="
                                                        return confirm(
                                                            'Approve and process this service request immediately?',
                                                        );
                                                    "
                                                >
                                                    <i
                                                        class="bi bi-check-lg"
                                                    ></i>
                                                    Process
                                                </button>
                                            </form>

                                            <form
                                                th:action="@{/manager/services/reject}"
                                                method="post"
                                            >
                                                <input
                                                    type="hidden"
                                                    name="id"
                                                    th:value="${req.id}"
                                                />
                                                <button
                                                    type="submit"
                                                    class="btn btn-sm btn-danger"
                                                    onclick="
                                                        return confirm(
                                                            'Reject this request?',
                                                        );
                                                    "
                                                >
                                                    <i class="bi bi-x"></i>
                                                    Reject
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                                <tr th:if="${#lists.isEmpty(requests)}">
                                    <td
                                        colspan="5"
                                        class="text-center py-5 text-muted"
                                    >
                                        <i
                                            class="bi bi-inbox fs-1 d-block mb-3"
                                        ></i>
                                        No pending service requests.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script th:src="@{/js/app.js}"></script>
    </body>
</html>

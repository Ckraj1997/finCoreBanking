<!doctype html>
<html
    xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
    <head th:replace="~{fragments/head :: head}"></head>

    <body>
        <div th:replace="~{fragments/navbar :: navbar}"></div>
        <div th:replace="~{fragments/sidebar :: sidebar}"></div>

        <div class="main-content">
            <div class="container-fluid">
                <div class="row justify-content-center">
                    <div class="col-md-8 col-lg-6">
                        
                        <a th:href="@{/investments}" class="text-decoration-none text-muted mb-3 d-block">
                            <i class="bi bi-arrow-left"></i> Back to Dashboard
                        </a>

                        <div class="card shadow-sm border-0">
                            <div class="card-header bg-white border-bottom-0 pt-4 px-4">
                                <h4 class="fw-bold text-primary">Open Fixed Deposit</h4>
                                <p class="text-muted small mb-0">Secure your future with high-interest FDs</p>
                            </div>
                            
                            <div class="card-body p-4">

                                <div th:if="${error}" class="alert alert-danger d-flex align-items-center" role="alert">
                                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                                    <div th:text="${error}"></div>
                                </div>

                                <form th:action="@{/investments/create}" method="post">
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">Source Account</label>
                                        <select name="accountNumber" class="form-select p-3" required>
                                            <option value="" disabled selected>Select an account to debit</option>
                                            <option th:each="acc : ${accounts}" 
                                                    th:value="${acc.accountNumber}" 
                                                    th:text="${acc.accountNumber} + ' (Bal: ₹' + ${acc.balance} + ')'">
                                            </option>
                                        </select>
                                        <div class="form-text">Amount will be debited from this account instantly.</div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">Investment Amount (₹)</label>
                                        <div class="input-group">
                                            <span class="input-group-text bg-light">₹</span>
                                            <input type="number" id="amount" name="amount" class="form-control p-3" 
                                                   placeholder="Min 1000" min="1000" required oninput="calculateReturns()">
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label fw-semibold">Tenure (Months)</label>
                                        <select id="tenure" name="tenure" class="form-select p-3" required onchange="calculateReturns()">
                                            <option value="6">6 Months (5.5% Interest)</option>
                                            <option value="12" selected>12 Months (7.5% Interest)</option>
                                            <option value="24">24 Months (7.5% Interest)</option>
                                            <option value="36">36 Months (7.5% Interest)</option>
                                            <option value="60">60 Months (7.5% Interest)</option>
                                        </select>
                                    </div>

                                    <div class="alert alert-light border d-flex justify-content-between align-items-center mb-4">
                                        <div>
                                            <small class="text-muted d-block">Estimated Maturity Amount</small>
                                            <h4 class="mb-0 fw-bold text-success" id="previewAmount">₹ 0.00</h4>
                                        </div>
                                        <div class="text-end">
                                            <small class="text-muted d-block">Interest Rate</small>
                                            <span class="badge bg-primary" id="previewRate">7.5%</span>
                                        </div>
                                    </div>

                                    <div class="d-grid">
                                        <button type="submit" class="btn btn-primary btn-lg py-3">
                                            Create Fixed Deposit <i class="bi bi-check-lg ms-2"></i>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script th:src="@{/js/app.js}"></script>

        <script>
            function calculateReturns() {
                const amount = parseFloat(document.getElementById('amount').value) || 0;
                const tenure = parseInt(document.getElementById('tenure').value) || 12;
                
                let rate = (tenure >= 12) ? 7.5 : 5.5;
                
                // Compound Interest Formula: A = P(1 + r/n)^(nt)
                // Quarterly compounding (n=4)
                const r = rate / 100;
                const n = 4;
                const t = tenure / 12.0;
                
                const maturityAmount = amount * Math.pow(1 + (r / n), n * t);

                // Update UI
                document.getElementById('previewAmount').innerText = "₹ " + maturityAmount.toFixed(2);
                document.getElementById('previewRate').innerText = rate + "%";
            }
        </script>
    </body>
</html>
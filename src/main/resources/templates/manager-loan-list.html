<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
    <head th:replace="~{fragments/head :: head}"></head>
    <body>
        <div th:replace="~{fragments/navbar :: navbar}"></div>
        <div th:replace="~{fragments/sidebar :: sidebar}"></div>

        <div class="main-content">
            <h2 class="mb-4 text-success">Loan Sanctioning Authority</h2>

            <div
                th:if="${success}"
                class="alert alert-success alert-dismissible fade show"
            >
                <i class="bi bi-check-circle-fill me-2"></i>
                <span th:text="${success}"></span>
                <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="alert"
                ></button>
            </div>
            <div
                th:if="${error}"
                class="alert alert-danger alert-dismissible fade show"
            >
                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                <span th:text="${error}"></span>
                <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="alert"
                ></button>
            </div>

            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-dark">
                                <tr>
                                    <th>Loan ID</th>
                                    <th>Applicant</th>
                                    <th>Type</th>
                                    <th>Amount</th>
                                    <th>Tenure</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="loan : ${loans}">
                                    <td
                                        class="fw-bold"
                                        th:text="'#LN-' + ${loan.id}"
                                    >
                                        #LN-1
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div
                                                class="avatar-circle bg-light text-secondary me-2"
                                            >
                                                <i class="bi bi-person"></i>
                                            </div>
                                            <div>
                                                <span
                                                    class="d-block fw-bold"
                                                    th:text="${loan.user.username}"
                                                    >User</span
                                                >
                                                <small
                                                    class="text-muted"
                                                    th:text="${loan.user.email}"
                                                    >user@email.com</small
                                                >
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span
                                            class="badge bg-secondary"
                                            th:text="${loan.loanType}"
                                            >PERSONAL</span
                                        >
                                    </td>
                                    <td class="fw-bold text-success">
                                        â‚¹
                                        <span
                                            th:text="${#numbers.formatDecimal(loan.amount, 0, 'COMMA', 2, 'POINT')}"
                                            >50,000.00</span
                                        >
                                    </td>
                                    <td>
                                        <span th:text="${loan.tenureMonths}"
                                            >12</span
                                        >
                                        Months
                                    </td>
                                    <td>
                                        <div   class="d-flex gap-2">
                                            <form
                                                th:action="@{'/manager/loans/' + ${loan.id} + '/approve'}"
                                                method="post"
                                            >
                                                <button th:if="${loan.status == 'PENDING'}"
                                                    type="submit"
                                                    class="btn btn-sm btn-success"
                                                    onclick="
                                                        return confirm(
                                                            'Confirm Loan Sanction? Funds will be disbursed immediately.',
                                                        );
                                                    "
                                                >
                                                    <i
                                                        class="bi bi-cash-coin me-1"
                                                    ></i>
                                                    Sanction & Disburse
                                                </button>
                                            </form>

                                            <a
                                                th:if="${loan.status == 'APPROVED'}"
                                                th:href="@{'/manager/loans/' + ${loan.id} + '/download-sanction'}"
                                                class="btn btn-sm btn-outline-dark"
                                            >
                                                <i class="bi bi-file-pdf"></i>
                                                Letter
                                            </a>

                                            <form
                                                th:action="@{'/manager/loans/' + ${loan.id} + '/reject'}"
                                                method="post"
                                            >
                                                <button th:if="${loan.status == 'PENDING'}"
                                                    type="submit"
                                                    class="btn btn-sm btn-danger"
                                                    onclick="
                                                        return confirm(
                                                            'Reject this loan application permanently?',
                                                        );
                                                    "
                                                >
                                                    <i
                                                        class="bi bi-x-circle me-1"
                                                    ></i>
                                                    Reject
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                                <tr th:if="${#lists.isEmpty(loans)}">
                                    <td
                                        colspan="6"
                                        class="text-center py-5 text-muted"
                                    >
                                        No pending loan applications found.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script th:src="@{/js/app.js}"></script>
    </body>
</html>
